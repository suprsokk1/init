---
- name: crontab
  hosts: localhost
  tasks:
  - ansible.builtin.cron:
      state: "present"
      name: "ansible pull"
      weekday: "*"
      minute: "*/5"
      hour: "*"
      month: "*"
      user: root
      job: "ansible-pull --url={{ pull_url }} --checkout={{ pull_branch }}"
      cron_file: ansible_pull
    ignore_errors: true

  - ansible.builtin.copy:
      mode: '0750'
      dest: '{{ ansible_user_dir }}/.local/bin/pull'
      content: |
        #!/bin/sh
        ansible-pull --url={{ pull_url }} --checkout={{ pull_branch }}
